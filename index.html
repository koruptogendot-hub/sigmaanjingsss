<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Send Gmail</title>
  <style>
    :root{
      --bg1:#000;
      --neon:#00f7ff;
      --accent1:#7c4dff;
      --accent2:#00c6ff;
      --card:#0f1115;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#020204 0%, #040608 100%);font-family:"Poppins",sans-serif;color:#e6fbff}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .panel{width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:26px;box-shadow:0 8px 40px rgba(0,0,0,0.6);backdrop-filter: blur(8px)}
    h1{margin:0 0 10px 0;color:var(--neon);text-shadow:0 0 12px rgba(0,255,255,0.06)}
    .field{margin-bottom:12px}
    .input, select{width:100%;padding:12px;border-radius:10px;border:none;background:#0b0b0b;color:#fff;box-shadow:inset 0 0 12px rgba(0,255,255,0.04)}
    .row{display:flex;gap:10px}
    .btn{padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#001219;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--neon);border:1px solid rgba(255,255,255,0.04)}
    .loader{width:44px;height:44px;border-radius:50%;border:4px solid rgba(255,255,255,0.06);border-top-color:var(--neon);animation:spin 0.9s linear infinite;margin:14px auto;display:none}
    @keyframes spin{to{transform:rotate(360deg)}}
    .result{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(0,0,0,0.36), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);display:none}
    .ok{color:#00ffcf}
    .bad{color:#ff6b6b}
    .meta{font-size:13px;color:#cfeef0;margin-top:8px}
    .small{font-size:13px;color:rgba(255,255,255,0.7)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="main">
      <h1>Send Gmail</h1>
      <p class="small">Masukkan nomor, pilih Gmail pengirim lalu klik KIRIM. Hasil akan tampil lengkap.</p>

      <div class="field">
        <input id="number" class="input" type="number" placeholder="Masukkan nomor (contoh: 62812...)" />
      </div>

      <div class="field">
        <select id="gmailSelect" class="input">
          <option value="0">Gmail #1 &lt;gmail1@gmail.com&gt;</option>
          <option value="1">Gmail #2 &lt;gmail2@gmail.com&gt;</option>
          <option value="2">Gmail #3 &lt;gmail3@gmail.com&gt;</option>
          <option value="3">Gmail #4 &lt;gmail4@gmail.com&gt;</option>
          <option value="4">Gmail #5 &lt;gmail5@gmail.com&gt;</option>
          <option value="5">Gmail #6 &lt;gmail6@gmail.com&gt;</option>
          <option value="6">Gmail #7 &lt;gmail7@gmail.com&gt;</option>
          <option value="7">Gmail #8 &lt;gmail8@gmail.com&gt;</option>
          <option value="8">Gmail #9 &lt;gmail9@gmail.com&gt;</option>
          <option value="9">Gmail #10 &lt;gmail10@gmail.com&gt;</option>
        </select>
      </div>

      <div class="row" style="margin-top:6px">
        <button id="backBtn" class="btn ghost" style="flex:1;display:none">‚Üê Back</button>
        <button id="sendBtn" class="btn" style="flex:1">üöÄ KIRIM</button>
      </div>

      <div class="loader" id="loader"></div>

      <div id="result" class="result" role="status" aria-live="polite"></div>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('sendBtn');
    const loader = document.getElementById('loader');
    const result = document.getElementById('result');

    function showLoader(show){
      loader.style.display = show ? 'block' : 'none';
    }
    function showResult(success, html){
      result.style.display = 'block';
      result.className = 'result ' + (success ? 'ok' : 'bad');
      result.innerHTML = html;
    }

    sendBtn.addEventListener('click', async () => {
      const number = document.getElementById('number').value.trim();
      const gmailIndex = document.getElementById('gmailSelect').value;

      if(!number){
        alert('Masukkan nomor terlebih dahulu!');
        return;
      }

      showLoader(true);
      result.style.display = 'none';

      try {
        const res = await fetch('/api/send', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ number, gmailIndex })
        });

        const j = await res.json();
        showLoader(false);

        if(res.ok && j.success){
          showResult(true, `
            <div style="font-weight:700">‚úÖ SUCCESS SEND TO EMAIL TARGET</div>
            <div class="meta"><b>TO:</b> ${escapeHtml(j.to || '')}</div>
            <div class="meta"><b>TIME SEND:</b> ${escapeHtml(j.time || '')}</div>
            <div class="meta"><b>MESSAGE ID:</b> ${escapeHtml(j.messageId || '')}</div>
          `);
        } else {
          const errMsg = j && j.error ? j.error : (j.detail || 'Unknown error');
          showResult(false, `<div style="font-weight:700">‚ùå FAILED</div><div class="meta"><b>Error:</b> ${escapeHtml(errMsg)}</div>`);
        }
      } catch (err){
        showLoader(false);
        showResult(false, `<div style="font-weight:700">‚ùå FAILED</div><div class="meta"><b>Error:</b> ${escapeHtml(err.message)}</div>`);
      }
    });

    function escapeHtml(s){
      if(!s) return '';
      return String(s).replace(/[&<>"'`]/g, function(m){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'})[m];
      });
    }
  </script>
</body>
</html>
