<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Send Gmail</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="background">
    <canvas id="cyberLines"></canvas>
  </div>

  <section class="intro" id="intro">
    <h1 class="title">SEND GMAIL</h1>
    <button id="startBtn" class="btn-start">Start Sending</button>
  </section>

  <section class="main hidden" id="main">
    <h2 class="gmail-title">PILIH GMAIL</h2>

    <div class="gmail-grid">
      <img src="gmail.png" alt="Gmail 1" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 2" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 3" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 4" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 5" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 6" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 7" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 8" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 9" class="gmail-logo">
      <img src="gmail.png" alt="Gmail 10" class="gmail-logo">
    </div>

    <div class="stats">
      <h3>STATISTIK SEND EMAIL ANDA</h3>
      <div class="stat-item">SUCCESS SEND: <span id="successCount">(0)</span></div>
      <div class="stat-item">FAILED SEND: <span id="failCount">(0)</span></div>
      <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
    </div>

    <form id="emailForm" class="email-form">
      <input type="text" id="number" placeholder="Masukkan Number" required>
      <button type="submit" class="send-btn">Send Gmail</button>
    </form>

    <div class="result" id="result"></div>
  </section>

  <script src="script.js"></script>
</body>
</html>
          <div id="failedBox" class="result failed" role="status" aria-live="polite"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- SCRIPT: UI behavior + particles + send (unchanged action to /api/send) -->
  <script>
    // DOM references
    const intro = document.getElementById('intro');
    const main = document.getElementById('main');
    const startBtn = document.getElementById('startBtn');
    const gmailCells = document.querySelectorAll('.gmail-cell');

    // Start button: zoom + fade into main
    startBtn.addEventListener('click', () => {
      intro.classList.add('intro-zoomout');
      setTimeout(() => {
        intro.classList.add('hidden');
        main.classList.remove('main-hidden');
        main.classList.add('main-zoomin');
        main.setAttribute('aria-hidden', 'false');
      }, 700);
    });

    // Gmail selection
    gmailCells.forEach(cell => {
      cell.addEventListener('click', () => {
        gmailCells.forEach(c => c.classList.remove('active'));
        cell.classList.add('active');
      });
    });

    // send button behavior -> posts to /api/send (unchanged)
    const sendBtn = document.getElementById('sendBtn');
    const loader = document.getElementById('loader');
    const successBox = document.getElementById('successBox');
    const failedBox = document.getElementById('failedBox');
    const successCountEl = document.getElementById('successCount');
    const failedCountEl = document.getElementById('failedCount');
    const progressBar = document.getElementById('progressBar');
    const progressPercent = document.getElementById('progressPercent');

    let successCount = 0;
    let failedCount = 0;

    sendBtn.addEventListener('click', async () => {
      const target = document.getElementById('number').value.trim();
      if (!target) { alert('Please enter a target (number or email).'); return; }

      loader.style.display = 'block';
      successBox.style.display = 'none';
      failedBox.style.display = 'none';

      try {
        const res = await fetch('/api/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ number: target })
        });

        const data = await res.json();
        loader.style.display = 'none';

        if (res.ok) {
          successCount++;
          successCountEl.textContent = successCount;
          successBox.innerHTML = '<strong>SUCCESS SEND TO TARGET EMAIL</strong><br>TIME SEND: ' +
            new Date().toLocaleString() + '<br>MESSAGE ID: ' + (data.messageId || '9999');
          successBox.style.display = 'block';
        } else {
          failedCount++;
          failedCountEl.textContent = failedCount;
          failedBox.innerHTML = '<strong>FAILED SEND</strong><br>' + (data.error || 'Unknown error');
          failedBox.style.display = 'block';
        }

      } catch (err) {
        loader.style.display = 'none';
        failedCount++;
        failedCountEl.textContent = failedCount;
        failedBox.innerHTML = '<strong>FAILED SEND</strong><br>Network error';
        failedBox.style.display = 'block';
      }

      // update progress visually (success ratio)
      const total = successCount + failedCount;
      const pct = total ? Math.round((successCount / total) * 100) : 0;
      progressBar.style.width = pct + '%';
      progressPercent.textContent = pct + '%';
    });

    // -------- background lines (cyber lines) ----------
    const canvas = document.getElementById('bgLines');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // create vertical moving line objects
    const lines = [];
    function initLines() {
      lines.length = 0;
      const count = Math.round(window.innerWidth / 40);
      for (let i = 0; i < count; i++) {
        const x = (i + 0.5) * (canvas.width / count);
        lines.push({
          x,
          offset: (Math.random() - 0.5) * 200,
          speed: 0.2 + Math.random() * 0.6,
          width: 1 + Math.random() * 2,
          alpha: 0.03 + Math.random() * 0.06
        });
      }
    }
    initLines();
    window.addEventListener('resize', initLines);

    function drawLines() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // subtle dark gradient backdrop strokes
      lines.forEach((ln, i) => {
        ln.offset += ln.speed;
        if (ln.offset > canvas.height + 200) ln.offset = -200 - Math.random() * 200;
        // draw a soft vertical band (two strokes for depth)
        ctx.beginPath();
        ctx.lineWidth = ln.width;
        ctx.strokeStyle = 'rgba(50,50,50,' + (ln.alpha * 0.9) + ')';
        ctx.moveTo(ln.x, -300 + ln.offset * 0.3);
        ctx.lineTo(ln.x, canvas.height + 300 + ln.offset * 0.3);
        ctx.stroke();

        ctx.beginPath();
        ctx.lineWidth = ln.width * 0.6;
        ctx.strokeStyle = 'rgba(30,30,30,' + (ln.alpha) + ')';
        ctx.moveTo(ln.x + 6, -300 + ln.offset * 0.6);
        ctx.lineTo(ln.x + 6, canvas.height + 300 + ln.offset * 0.6);
        ctx.stroke();
      });
      requestAnimationFrame(drawLines);
    }
    drawLines();

    // small floating animation for gmail icons (subtle)
    setInterval(() => {
      document.querySelectorAll('.gmail-svg').forEach((el, idx) => {
        const r = 1 + Math.sin((Date.now() / 1000) + idx) * 0.02;
        el.style.transform = `translateY(${Math.sin((Date.now()/1000)+idx)*4}px) scale(${r}) rotate(${Math.sin((Date.now()/1400)+idx)*1}deg)`;
      });
    }, 32);
  </script>
</body>
</html>
