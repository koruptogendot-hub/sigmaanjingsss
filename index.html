<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Send Gmail</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="particles"></canvas>

  <!-- INTRO SECTION -->
  <section id="intro" class="show">
    <h1 class="neonTitle">Send Gmail System</h1>
    <p class="subtext">Powerful Email Sender Dashboard</p>
    <button id="startBtn">Start Sending</button>
  </section>

  <!-- MAIN SECTION -->
  <section id="main" class="hidden">
    <h2 class="mainTitle">Send Gmail</h2>

    <div class="gmail-container">
      <div class="gmail-row">
        <div class="gmail-icon active" title="Gmail 1"></div>
        <div class="gmail-icon" title="Gmail 2"></div>
        <div class="gmail-icon" title="Gmail 3"></div>
        <div class="gmail-icon" title="Gmail 4"></div>
        <div class="gmail-icon" title="Gmail 5"></div>
      </div>
      <div class="gmail-row">
        <div class="gmail-icon" title="Gmail 6"></div>
        <div class="gmail-icon" title="Gmail 7"></div>
        <div class="gmail-icon" title="Gmail 8"></div>
        <div class="gmail-icon" title="Gmail 9"></div>
        <div class="gmail-icon" title="Gmail 10"></div>
      </div>
    </div>

    <div class="stats">
      <h3 class="neonSub">Statistik Pengiriman</h3>
      <div class="stat-item successStat">SUCCESS SEND: <span id="successCount">0</span></div>
      <div class="stat-item failedStat">FAILED SEND: <span id="failedCount">0</span></div>
      <div class="progress-bar">
        <div class="progress" id="progress"></div>
      </div>
    </div>

    <div class="card">
      <input id="number" type="text" placeholder="Enter Target Email" class="input" />
      <button id="sendBtn" class="btn-send">Send Gmail</button>
      <div class="loader" id="loader"></div>
      <div class="status-box">
        <div id="successBox" class="success"></div>
        <div id="failedBox" class="failed"></div>
      </div>
    </div>
  </section>

  <script>
    const intro = document.getElementById('intro');
    const main = document.getElementById('main');
    const startBtn = document.getElementById('startBtn');

    startBtn.onclick = () => {
      intro.classList.add('fadeOut');
      setTimeout(() => {
        intro.classList.add('hidden');
        main.classList.remove('hidden');
        main.classList.add('fadeIn');
      }, 1000);
    };

    document.querySelectorAll('.gmail-icon').forEach(icon => {
      icon.onclick = () => {
        document.querySelectorAll('.gmail-icon').forEach(i => i.classList.remove('active'));
        icon.classList.add('active');
      };
    });

    const sendBtn = document.getElementById('sendBtn');
    const loader = document.getElementById('loader');
    const successBox = document.getElementById('successBox');
    const failedBox = document.getElementById('failedBox');
    const successCount = document.getElementById('successCount');
    const failedCount = document.getElementById('failedCount');
    const progress = document.getElementById('progress');

    let success = 0, failed = 0;

    sendBtn.onclick = async () => {
      const number = document.getElementById('number').value.trim();
      if (!number) return alert('Masukkan email target!');
      loader.style.display = 'block';
      successBox.style.display = 'none';
      failedBox.style.display = 'none';

      try {
        const res = await fetch('/api/send', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ number })
        });
        const data = await res.json();
        loader.style.display = 'none';
        if (res.ok) {
          success++;
          successBox.innerHTML = `
            <h4>SUCCESS SEND TO TARGET EMAIL</h4>
            <p>TIME SEND: ${new Date().toLocaleTimeString()}</p>
            <p>MESSAGE ID: ${data.messageId || '9999'}</p>`;
          successBox.style.display = 'block';
        } else {
          failed++;
          failedBox.innerHTML = `<h4>FAILED SEND</h4><p>${data.error || 'Unknown Error'}</p>`;
          failedBox.style.display = 'block';
        }
        updateStats();
      } catch {
        loader.style.display = 'none';
        failed++;
        failedBox.innerHTML = `<h4>FAILED SEND</h4><p>Network Error</p>`;
        failedBox.style.display = 'block';
        updateStats();
      }
    };

    function updateStats() {
      successCount.textContent = success;
      failedCount.textContent = failed;
      const total = success + failed;
      progress.style.width = total ? (success / total * 100) + '%' : '0%';
    }

    // particle background
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    const particles = Array.from({ length: 100 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 2 + 1,
      dx: (Math.random() - 0.5) * 0.6,
      dy: (Math.random() - 0.5) * 0.6
    }));
    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(0,255,255,0.6)';
        ctx.fill();
        p.x += p.dx; p.y += p.dy;
        if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
        if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();
  </script>
</body>
</html>
